<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Data Visualization in the Browser</title>

		<meta name="description" content="A presentation on browser based data visualization">
		<meta name="author" content="Rob Larsen">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/robreact.css" id="theme">
    
		<link rel="stylesheet" href="css/dataviz.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h1>Data Visualization in the Browser</h1>
					<h2>Rob Larsen</h2>
					<h2>2014.2.1*</h2>
          <small><a href="https://github.com/roblarsen/dataviz">Download</a> (https://github.com/roblarsen/dataviz)</small>
          <p><img src="img/logo.png" height="150" width="150"></p>
				</section>
				<section>
					<h1>What's in this Presentation</h1>
					<ul>
            <li>Me, Briefly</li>
            <li>Two core technologies: SVG &amp; Canvas</li>   
						<li>Live examples</li>
          </ul>
				</section>
				<section>
  				<section>
	  				<h1>Me</h1>
	  				<img src="img/me.jpg" alt="Rob Larsen" width="395" height="395">
			  	</section>
				  <section>	
					  <h1>Work</h1>
						<ul>
						  <li>I've been making web sites since 1997</li>
						  <li>I've been primarily focused on HTML, CSS &amp; JavaScript that whole time</li>
						  <li>Formerly an agency guy/consultant. Lots of big brand stuff (Adidas, Motorola, Samsung, etc.)</li>
            </ul>
					</section>
					<section class="bio">
						<h1>Work</h1>
					  <ul>	
						  <li>I'm <a ref="https://github.com/roblarsen">roblarsen</a> on Github</li>
					    <li>I'm <a href="https://twitter.com/robreact">@robreact</a> on Twitter</li>
              <li>I have a blog @ <a href="http://HTMLCSSJavaScript.com">htmlcssjavascript.com</a></li>
					    <li>I write books. </li>
					  </ul>
   <a href="http://www.amazon.com/gp/product/1118340183/ref=as_li_ss_tl?ie=UTF8&camp=1789&creative=390957&creativeASIN=1118340183&linkCode=as2&tag=drunkenfistcom"><img src="img/beginning-html-and-css.jpg" alt="an image of Rob Larsen's Beginning HTML and CSS" width="178" height="225" /></a>
                      
					</section>
				</section>
				<section>
					<h1>Data Visualization?</h1>
				  <a href="http://www.flickr.com/photos/andreasmb/3100291750/" title="Visualization Examples  by Andreas_MB, on Flickr"><img src="img/3100291750_8623c332f9.jpg" width="500" height="333" alt="Visualization Examples "></a>	
				  <small>Rhymes with crufty. <a href="http://www.flickr.com/photos/andreasmb/3100291750/">Photo from Andreas_MB on Flickr</a></small>
		       <aside class="notes">
            Anyone been to one of the Eddward Tufte talks? 
          </aside>
        </section>
        <section>
          <h1>Basically</h1>
        </section>
        <section>
          <h1>Taking this</h1>
          <pre><code>{"username": "rob_react", "weeks": {"1152446400": {"Pink": 2, "The Decemberists": 3, "Jerry Jeff Walker": 7, "The Clash": 2, "Jim Carroll Band": 2, "Big Audio Dynamite II": 1, "The Beatles": 12, "Cheap Trick": 1, "Rod Stewart": 3, "Ninja Tunes": 1, "Nas": 1, "Boogie Down Productions": 1, "Everclear": 8, "DANGERDOOM": 2, "Paul Simon": 1, "Macy Gray": 1, "Jem": 1, "Terror Danjah Ft. Riko, Bruza, D Double E And Hyper": 1, "Kelly Willis": 1, "Herman's Hermits": 1, "Tool": 1, "Sound Tracks": 1, "The Cure": 1, "Belle and Sebastian": 9, "Tom Waits": 2, "Nick Drake": 1, "Jammer Ft. Wiley, D Double E, Kano and Goodz": 2, "Oasis": 4, "Acid House Kings": 2, "Ralph Stanley &amp; Friends": 1, "Joe Jackson": 1, "The Libertines": 7, "Wilco": 1, "Sublime": 5, "The Cardigans": 1, "Bill Hicks": 3, "Harry Nilsson": 1, "Operation Ivy": 1, "Bob Dylan": 11, "Joni Mitchell": 1, "Led Zeppelin": 1, "50 Cent": 1, "Black Crowes &amp; Wilco": 1, "Kano": 1, "Mason Jennings": 7, "Dave Matthews Band": 1, "The White Stripes": 1, "Michael Penn": 4, "Ralph Stanley": 1, "Kirsty MacColl / The Pogues": 1, "Billy Bragg &amp; Wilco": 2, "Misfits": 3, "The Pretenders": 2, "The Pogues": 12, "Sangue Misto": 1, "Rufus": 1, "The Beach Boys": 2, "Marvin Gaye": 2, "The Strokes": 3, "The Streets": 5, "The Stanley Brothers": 5, "Franz Ferdinand": 1, "Dave Matthews": 1, "My Morning Jacket": 1</code></pre>
        </section>
        <section>
          <h1>And turning it into this</h1>
          <div class="big-image" id="last-fm-svg"><div><img src="img/graph_236833.svgz" width="1260" height="510"></div></div>
          <small>Generated with the awesome <a href="http://lastgraph3.aeracode.org/">http://lastgraph3.aeracode.org/</a></small>
        </section>
        <section>
          <h1>Two Technologies</h1>
        </section>
        <section>
          <section>
            <h1>Scalable Vector Graphics (SVG)</h1>
          </section>
          <section>
            <h1>What is SVG</h1>
            <p>SVG is vector graphics mixed up with XML.</p>
            <p>When created in the context of an HTML document SVG elements are funky DOM elements-- properties are stored as part of the regular DOM and access to individual elements is available using traditional DOM access methods like <code>document.geElementById</code> and <code>document.getElementsByTagName</code> (or, if you only speak jQuery <code>$()</code>)</p><p>It can also be styled with CSS.</p>
          </section>
          <section>
            <h1>Have I mentioned SVG is better than sliced bread</h1>
            <p>It is</p>
            <p>Why?</p>
          	<p>SVG can also be output from a vector based drawing program and used as the <code>src</code> of an <code>&lt;img&gt;</code> element or as the background of an element as defined by CSS. </p>
          </section>
          <section>
            <h1>Vector means: it scales!</h1>
          	<img src="img/HTML5-logo.svg" width="5%">
          	<img src="img/HTML5-logo.svg" width="10%">
          	<img src="img/HTML5-logo.svg" width="15%">
          	<img src="img/HTML5-logo.svg" width="20%">
          	<img src="img/HTML5-logo.svg" width="25%">
          	<img src="img/HTML5-logo.svg" width="100%">
              <aside class="notes">
               And on and on until you've scaled up to the size of the side of a building. 
              </aside>
          </section>	
          <section>
            <h1>It looks like this</h1>
            <svg width="200" height="200"
              viewPort="0 0 200 200" version="1.1"
              xmlns="http://www.w3.org/2000/svg">
              <circle cx="100" cy="100" r="75" fill="#fe57a1"/>
            </svg>

          </section>
          <section>
            <h1>Viewing Source</h1>
            <pre><code>
&lt;svg width=&quot;200&quot; height=&quot;200&quot;
    viewPort=&quot;0 0 200 200&quot; version=&quot;1.1&quot;<br>
    xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;<br>
    &lt;circle cx=&quot;100&quot; cy=&quot;100&quot; r=&quot;75&quot; fill=&quot;#fe57a1&quot;/&gt;<br>          
&lt;/svg&gt;
            </pre></code>
            <aside class="notes">
              As you can see it's XML and the definition of the different properties controls the display of the circle element. 
            </aside>
          </section>
          <section>
            <h1>It can also look like this</h1>
            <img src="img/circle.svg">
          </section>
          <section>
            <h1>Viewing Source</h1>
            <pre><code>
&lt;img src="img/circle.svg"&gt;
            </pre></code>
            <aside class="notes">
              Everyone knows how that works.  
            </aside>
          </section>
          <section>
            <h1>Support</h1>
            <div class="support svg"></div>
            <small>data from caniuse.com</small>
          </section>
        </section>
        <section>
          <section>
            <h1>Canvas</h1>
          </section>
          <section>
            <h1>What's Canvas?</h1>
            <p>The canvas element and associated API started life as an Apple extension to HTML. From there it blossomed into one of the early stars of the HTML5 era.</p> 
            <p>The canvas element provides a scriptable interface for drawing two-dimensional images in the browser.</p>
          </section>
          <section>
            <h1>Stay in control</h1>
            <p>It's an extremely low level API. This means you often have to do a bit of work but you have complete, pixel level control.</p>
          </section>
          <section>
            <h1>It looks like this</h1>
            <canvas id="circle" width="800" height="300"></canvas>
          </section>
          <section>
            <h1>Viewing Source</h1>
            <pre><code>
&lt;canvas id=&quot;circle&quot; width=&quot;800&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
            </code></pre>
            <pre><code>
   var ctx = document.getElementById( "circle" ).getContext( "2d" );
   ctx.beginPath();
   ctx.arc( 400, 150, 75, 0, Math.PI*2, true ); 
   ctx.fillStyle = "#fe57a1";
   ctx.closePath();
   ctx.fill();
            </code></pre>
          </section>
          <section>
            <h1>Did I say low level API?</h1>
            <h2>I sure did. Everyone knows <code>arc</code> is all you need when you have <code>Math.PI*2</code></h2>
            <pre><code>
            ctx.arc( 400, 150, 75, 0, Math.PI*2, true );
            </code></pre>
            <small>Not the friendliest API. It's "center x", "center y", "radius", "start angle, in radians", "end angle, in radians" and "clockwise, as a Boolean"</small>
          </section>
          <section>
            <h1>Support</h1>
            <div class="support canvas"></div>
            <small>data from caniuse.com</small>
          </section> 
        </section>
        <section>
        	<section>
        	  <h1>Comparing Canvas &amp; SVG</h1>
          </section>
          <section>
          	<h1>At a High Level</h1>
            <p>Generally... Go SVG when dealing with a limited number of elements, lower animation requirements and higher interactivity needs. Because it's got traditional access methods and traditional event registration, it's more familiar to the average front end engineer. It's easier to implement in an accessible way.</p>
            <p>Designers can also export SVGs for you to work with out of software like Adobe Illustrator</p>
            <small>Two big SVG libraries are also polyfilled by default (Raphaël and Highcharts.) That's useful if you have legacy IE requirements. </small>
          </section>
          <section>
            <h1>Canvas Strengths</h1>
            <p>Canvas is better for applications that require intense animation, real-time interaction and/or <strong>many</strong> more elements. SVG elements are DOM elements so thousands of them is kind of scary. Thousands of "elements" in the canvas is still just the one element being manipulated pixel by pixel.</p>
            <p>Of course, things can bog down with Canvas too- it just won't be because you've got a Mega-DOM.</p>
          </section>
          <section>
          <h1>Scaling matters</h1>
            <p>One important note: If different resolutions and form factors are the kind of thing that keeps you up at night, make nice with SVG. Canvas = bitmap. SVG = vector. Bitmaps don't scale. Vector scales all day. </p>
          </section>
          <section>
          <h1>Your Mileage May Vary</h1>
            <p>This issue could be a whole presentation all by itself. It's a nuanced topic. To help, here are a couple of articles which cover this question in greater depth:</p>
            <ul>
              <li><a href="http://msdn.microsoft.com/en-us/library/ie/gg193983(v=vs.85).aspx">How To Choose Between SVG and Canvas</a></li>
              <li><a href="http://html5center.sourceforge.net/How-to-Choose-Between-Canvas-and-SVG-for-your-Site">How to Choose Between Canvas and SVG for your Site</a></li>
            </ul>
          </section>
          <section>
          <h1>Use what works</h1>
            <p>Canvas, SVG, HTML elements + CSS animations, Google Maps, etc. It's all good as long as you're telling a story.</p>
          </section>
          
        </section>
        <section>
          <h1>In Practice</h1>
          <p>What follows is a cross section of the tools and approaches I've used over the past few years.</p>
        </section>
        </section>
        <section>
          <section>
            <h1>AngularJS and SVG</h1>
            <p>Working with Angular and SVG is natural. As I've mentioned, SVG elements are just DOM elements, so anything you know how to do with traditional HTML elements you can do with SVG</p>
          
          </section>  
        </section>
        <section>
          <section>
            <h1>SVG with D3js</h1>
            <blockquote cite="http://d3js.org/">D3.js is a JavaScript library for manipulating documents based on data. D3 helps you bring data to life using HTML, SVG and CSS. D3’s emphasis on web standards gives you the full capabilities of modern browsers without tying yourself to a proprietary framework, combining powerful visualization components and a data-driven approach to DOM manipulation.</blockquote>
         </section>
         <section id="d3">
<iframe width="100%" height="500" ></iframe>
<small> data from the <a href="http://hubwaydatachallenge.org/">Hubway Data Visualization Challenge</a></small>
        </section>
        <section>
          <h1>View Source</h1>
          <pre><code>
[
  [2689, 508, 1170, 189, 1007, 187,  745,  248,  263,  2311], 
  [1064, 121, 830,  323, 2473, 393,  453,  312,  533,  599], 
  [506,  296, 813,  530, 988,  540,  1936, 578,  747,  268], 
  [706,  311, 1568, 526, 1273, 371,  618,  694,  481,  227], 
  [178,  701, 277,  176, 663,  227,  379,  284,  330,  111], 
  [550,  270, 548,  445, 196,  769,  868,  317,  1477, 195], 
  [344,  141, 468,  955, 172,  346,  502,  388,  415,  97], 
  [333,  207, 455,  545, 196,  1322, 618,  254,  659,  62], 
  [655,  120, 301,  90,  2368, 108,  226,  99,   229,  875], 
  [270,  221, 625,  436, 239,  278,  548,  1158, 320,  90]
]
          </pre></code>
        </section>
        <section>
          <h1>View Source</h1>
<pre><code>
//from bl.ocks.org/mbostock/4062006 etc. 
var chord = d3.layout.chord()
    .padding( .05 )
    .sortSubgroups( d3.descending )
    .matrix( matrix );
var width = 900,
    height = 500,
    innerRadius = Math.min( width, height ) * .35,
    outerRadius = innerRadius * 1.1;

var fill = d3.scale.ordinal()
             .domain( d3.range(4) )
             .range(["#336699", "#99ccff", "#6699cc", "#0066cc"]);

var svg = d3.select( "body" )
            .append( "svg" )
            .attr( "width", width )
            .attr( "height", height )
            .append( "g" )
            .attr( "transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.append( "g" )
   .selectAll( "path" )
   .data( chord.groups )
   .enter()
   .append( "path" )
   .style( "fill", function(d) { return fill(d.index); })
   .style( "stroke", function(d) { return fill(d.index); })
   .attr( "d", d3.svg.arc().innerRadius( innerRadius ).outerRadius( outerRadius ))
   .on( "mouseover" , fade(.1) )
   .on( "mouseout" , fade(1) );
 
var ticks = svg.append( "g" )
               .selectAll( "g" )
               .data( chord.groups )
               .enter().append( "g" )
               .selectAll( "g" )
               .data( groupTicks )
               .enter()
               .append( "g" )
               .attr( "transform", function( d ) {
                 return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                    + "translate(" + outerRadius + ",0)";
                });

ticks.append( "line" )
     .attr( "x1", 1 )
     .attr( "y1", 0 )
     .attr( "x2", 5 )
     .attr( "y2", 0 )
     .style( "stroke", "#000" );
var arc = d3.svg
            .arc()
            .innerRadius( innerRadius );
ticks.append( "text" )
     .attr( "x", 8 )
     .attr( "dy", ".35em" )
     .attr( "transform", function(d) { return d.angle > Math.PI ? "rotate(180)translate(-16)" : null; })
     .style( "text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
     .text( function(d) { return d.label; });

svg.append( "g" )
   .attr( "class", "chord" )
   .selectAll( "path" )
   .data( chord.chords )
   .enter()
   .append( "path" )
   .attr( "d", d3.svg.chord().radius( innerRadius ))
   .style( "fill", function(d) { return fill(d.target.index); })
   .style( "opacity", 1)
   .outerRadius( outerRadius );

 var g = svg.selectAll( "g.group" )
            .data( chord.groups )
            .enter()
            .append( "svg:g" )
            .attr( "class", "group")
            .on( "mouseover", fade(.02))
            .on( "mouseout", fade(.80));

  g.append( "svg:path" )
   .style( "stroke", function(d) { return fill(d.index); })
   .style( "fill", function(d) { return fill(d.index); })
   .attr( "d", arc);

  g.append( "svg:text" )
   .each(function(d) { d.angle = ( d.startAngle + d.endAngle ) / 2; })
   .attr( "dy", ".35em" )
   .attr( "text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
   .attr( "transform", function(d) {
    return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
        + "translate(" + (innerRadius + 26) + ")"
        + (d.angle > Math.PI ? "rotate(180)" : "");
   })
   .text(function(d) { return names[d.index]; });

function groupTicks(d) {
  var k = ( d.endAngle - d.startAngle ) / d.value;
  return d3.range( 0, d.value, 1000 ).map( function(v, i) {
    return {
      angle: v * k + d.startAngle,
      label: i % 5 ? null : v / 1000 + "k"
    };
  });
}

function fade( opacity ) {
  return function( g, i ) {
    svg.selectAll( ".chord path" )
        .filter(function(d) { return d.source.index != i &amp;&amp; d.target.index != i; })
      .transition()
        .style( "opacity", opacity );
  };
}
                
</code></pre>
          </section>
        </section>
        <section>
           <h1>SVG: Other Libraries</h1>
           <ul>
             <li><a href="http://svgjs.com/">SVG.js</a> <small>"a lightweight JavaScript library for manipulating and animating svg using an uncluttered syntax"</small></li>
             <li><a href="http://polymaps.org/">Polymaps</a> <small>"a free JavaScript library for making dynamic, interactive maps in modern web browsers."</small></li>
           </ul>
         </section>
        <section>
          <section>
            <h1>Canvas: Core Canvas </h1>
           <blockquote cite="http://www.w3.org/TR/2dcontext2/#drawing-rectangles-to-the-canvas">This specification defines the 2D Context, Level 2 for the HTML canvas element. The 2D Context provides objects, methods, and properties to draw and manipulate graphics on a canvas drawing surface.</blockquote>
         </section>
         <section id="canvas">
          <iframe  width="100%" height="500" ></iframe>
         </section>
        <section>
          <h1>View Source</h1>
          <pre><code>
function draw( data ) {
  ctx.fillRect( 0, 0, 900, 300 );
  var len = data.length,
      width = 900/len,
      gradient = ctx.createLinearGradient( 0, 0, 0, 300 );
      gradient.addColorStop( ".5", "#003366" );
      gradient.addColorStop( "1.0", "#ccff00" );
      ctx.fillStyle = gradient;
  for ( var i=0; i&lt;len; i++ ) {
      ctx.fillRect( i, 300, width, -data[i] );    
  }
}   
</code></pre>
        </section>
       </section>
        <section>
           <h1>Canvas: Other Libraries</h1>
           <ul>
             <li><a href="http://sigmajs.org/">sigma.js</a> <small>"an open-source lightweight JavaScript library to draw graphs, using the HTML canvas"</small></li>
             <li><a href="http://paperjs.org/">paper.js</a> <small>"Scriptographer ported to JavaScript and browser, using HTML5 Canvas"</small></li>
              <li><a href="http://benpickles.github.com/peity/">Peity</a> <small>"progressive &lt;canvas&gt; piecharts"</small></li>
              <li><a href="http://arborjs.org/">arbor.js</a> <small>"a graph visualization library using web workers and jQuery"</small></li>
              <li><a href="http://www.humblesoftware.com/envision">envision</a> <small>"a library for creating fast, dynamic and interactive HTML5 visualizations.</small></li>
              <li><a href="http://canvasquery.com/">CanvasQuery</a> <small>"use HTML5 Canvas with jQuery syntax"</small></li>
              <li><a href="http://processingjs.org">Processing.js</a> <small>"the sister project of the popular Processing visual programming language"</small></li>
           </ul>
         </section>
        </section>
        <section>
          <section>
            <h1>Google Maps</h1>
          </section>
          <section>
            <h1>Google Maps</h1>
            <blockquote cite="https://developers.google.com/maps/documentation/javascript/">The Google Maps Javascript API lets you embed Google Maps in your own web pages. Version 3 of this API is especially designed to be faster and more applicable to mobile devices, as well as traditional desktop browser applications.
            </blockquote>
          </section>
          <section>
            <h1>About Google Maps</h1>
            <p>The Maps API is already rich, adding a layer of data on top of it opens up a wide range of possibilities</p>
          </section>
           <section id="gm">
         
          <iframe  width="100%" height="500" ></iframe>
          <small><a href="http://htmlcssjavascript.com/javascript/sure-its-5-months-too-late-for-the-contest-but-i-finally-did-something-with-the-hubway-data/">Read all about this visualization</a> http://dfst.us/1e5y  </small>
         </section>
          <section>
           <img src="img/hubway-static.png" width="100%">
         <small><a href="http://htmlcssjavascript.com/javascript/sure-its-5-months-too-late-for-the-contest-but-i-finally-did-something-with-the-hubway-data/">Read all about this visualization</a> http://dfst.us/1e5y </small></section>
          <section>
          <h1>Google Maps +-</h1>
          <ul>
            <li>Pluses:
              <ul>
                <li>Powerful, well documented API</li>
              </ul>
            </li>
            <li>Minuses:
              <ul>
                <li>If you get really popular it costs $$</li>
              </ul>
            </li>
         </ul>
        </section>
         <section>
          <h1>View Source</h1>
          <pre><code>
;( function( window, document, $, undefined ) {
  "use strict";
  if( window.HW === undefined ) {
    window.HW = {};
  };
  var HW = window.HW;
  HW.common = {
    init: function() {
      $( "#map" ).height( $( window ).height() );
      var GM = google.maps,
        defaultPosition = new GM.LatLng( 42.3520, -71.0560 ),
        mapOptions = {
          zoom: 12,
          center: defaultPosition,
          mapTypeId: GM.MapTypeId.ROADMAP
        },
        map = new GM.Map( document.getElementById( 'map' ), mapOptions ),
        geocoder = new GM.Geocoder(),
        position, endPosition, marker, polylineOptions, DD, DS;
      $( "#map" ).data( "map" , map );
      createMarker( 0 );
      var i = 1, timer;
      function render(){
        if ( i == 10 ){
          clearInterval( timer );
          return;
        }
        createMarker( i );
        i++;   
      }
      timer = setInterval( render, 10000 );
      function createMarker( i ){
        var marker, position, start, end, dist;
        position = new GM.LatLng( data.stations[i].latLng[0] , data.stations[i].latLng[1] );
        marker = new GM.Marker({
          position: position,
          map: map,
          title: data.stations[i].name,
          data: data.stations[i].destinations
        });
//http://www.movable-type.co.uk/scripts/latlong.html
//http://stackoverflow.com/questions/27928/how-do-i-calculate-distance-between-two-latitude-longitude-points
        function distance( lat1, lon1, lat2, lon2) {
          var R = 6371; // Radius of the earth in km
          var dLat = deg2rad( lat2-lat1 );  // deg2rad below
          var dLon = deg2rad( lon2-lon1 ); 
          var a = 
            Math.sin( dLat/2 ) * Math.sin( dLat/2 ) +
            Math.cos( deg2rad(lat1) ) * Math.cos( deg2rad( lat2 ) ) * 
            Math.sin( dLon/2 ) * Math.sin( dLon/2 ); 
          var c = 2 * Math.atan2( Math.sqrt( a ), Math.sqrt( 1-a ) ); 
          var d = R * c; // Distance in km
          return d;
        }

        function deg2rad( deg ) {
          return deg * ( Math.PI/180 )
        }

        var j = 0, len = data.stations[i].destinations.length, rendertimer;
        function newrender(){
          if ( j == len ){
            clearInterval( rendertimer )
          return;
          }
          dist = distance( data.stations[i].latLng[0],data.stations[i].latLng[1], data.stations[i].destinations[j].latLng[0], data.stations[i].destinations[j].latLng[1] )
          createRoutes( i, j, position, dist);
          j++;   
        }
        rendertimer = setInterval( newrender, 2000 );
        function createRoutes( i, j, start, distance) {
          start = position;
          end = data.stations[i].destinations[j].latLng;
          var trips = data.stations[i].destinations[j].trips;
          HW.common.renderer( start,end, trips, i, distance, data.stations[i].name, data.stations[i].destinations[j].name );
        }
      }       
    },
    renderer: function( start, end, trips, index, distance, startName, endName ) {
      var GM = google.maps,
        polylineOptions, DD, DS, map = $( "#map" ).data( "map" ),
        colors = ["#B22937","#DE5003","#80C837","#229F6E","#60B6CA","#6F6DA7", "#1F1D6D","#80529A","#A6358C","#A2395B"];
      end = new GM.LatLng( end[0], end[1] );
      var polylineOptions = new GM.Polyline({
        strokeColor : colors[index],
        strokeOpacity : .4,
        strokeWeight : trips/100
      }),
        DS = new GM.DirectionsService(),
        DD = new GM.DirectionsRenderer({
          polylineOptions : polylineOptions,
          markerOptions : { icon : "img/Hubwaylogo.png" }
        });
      DD.setMap( map );
      var request = {
        origin : start,
        destination : end,
        travelMode : GM.TravelMode.BICYCLING
      }; 
      DS.route( request, function( result, status ) {
        if( status == GM.DirectionsStatus.OK ) {
          DD.setDirections( result );
        }
      });
    }
  }
}( window, document, jQuery ));
         </code></pre>
        </section>
        </section>
        <section>
          <h1>My Columbo Moment</h1>
          <small class="fragment fade-in">just one more thing...</small>
          <h2 class="fragment fade-in"><a href="http://selection.datavisualization.ch">Datavisualization.ch Selected Tools</a></h2>
          <p class="fragment fade-in">A list of all these tools, plus more.</p>
        </section>
        <section>
          <h1>Thanks!</h1>
          <p><a ref="https://github.com/roblarsen">roblarsen</a> on Github | <a href="https://twitter.com/robreact">@robreact</a> on Twitter <br>
          blog @ <a href="http://HTMLCSSJavaScript.com">htmlcssjavascript.com</a></p>
        </section>
      </div>
		</div>

		<script src="lib/js/head.min.js"></script>
	  <script src="js/reveal.min.js"></script>
    <script src="../_assets/js/vendor/jquery-1.9.1.min.js"></script>

    <script src="../_assets/js/main.js"></script>
	  <script>
  	// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
        rollingLinks: false,
				progress: false,
				history: true,
				center: true,
  			theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
  			// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				],
        maxScale: 1.4
			});

		</script>

	</body>
</html>
